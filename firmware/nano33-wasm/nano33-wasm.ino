#include <wasm3.h>
#include <m3_env.h>

#ifdef REV2
#include <Arduino_BMI270_BMM150.h> // Biblioteca para o IMU (acelerômetro e giroscópio)
#else
#include <Arduino_LSM9DS1.h>
#endif

#include <ArduinoBLE.h>

#define WASM_STACK_SLOTS    1024
#define NATIVE_STACK_SIZE   (32*1024)

#define FATAL(func, msg) { Serial.print("Fatal: " func " "); Serial.println(msg); while(1) { delay(100); } }
#define TSTART()         { tstart = micros(); }
#define TFINISH(s)       { tend = micros(); Serial.print(s " in "); Serial.print(tend-tstart); Serial.println(" us"); }

unsigned char app_wasm[] = {
  0x00, 0x61, 0x73, 0x6d, 0x01, 0x00, 0x00, 0x00, 0x01, 0x35, 0x0a, 0x60,
  0x04, 0x7f, 0x7f, 0x7f, 0x7f, 0x01, 0x7f, 0x60, 0x01, 0x7f, 0x00, 0x60,
  0x00, 0x00, 0x60, 0x02, 0x7f, 0x7f, 0x00, 0x60, 0x01, 0x7f, 0x01, 0x7f,
  0x60, 0x02, 0x7f, 0x7f, 0x01, 0x7f, 0x60, 0x03, 0x7f, 0x7f, 0x7f, 0x00,
  0x60, 0x01, 0x7d, 0x00, 0x60, 0x00, 0x01, 0x7f, 0x60, 0x04, 0x7f, 0x7f,
  0x7f, 0x7f, 0x00, 0x02, 0xc6, 0x01, 0x0a, 0x07, 0x61, 0x72, 0x64, 0x75,
  0x69, 0x6e, 0x6f, 0x07, 0x70, 0x69, 0x6e, 0x4d, 0x6f, 0x64, 0x65, 0x00,
  0x03, 0x07, 0x61, 0x72, 0x64, 0x75, 0x69, 0x6e, 0x6f, 0x0c, 0x64, 0x69,
  0x67, 0x69, 0x74, 0x61, 0x6c, 0x57, 0x72, 0x69, 0x74, 0x65, 0x00, 0x03,
  0x07, 0x61, 0x72, 0x64, 0x75, 0x69, 0x6e, 0x6f, 0x05, 0x64, 0x65, 0x6c,
  0x61, 0x79, 0x00, 0x01, 0x07, 0x61, 0x72, 0x64, 0x75, 0x69, 0x6e, 0x6f,
  0x0b, 0x69, 0x6d, 0x75, 0x47, 0x79, 0x72, 0x6f, 0x52, 0x65, 0x61, 0x64,
  0x00, 0x06, 0x07, 0x61, 0x72, 0x64, 0x75, 0x69, 0x6e, 0x6f, 0x0a, 0x70,
  0x72, 0x69, 0x6e, 0x74, 0x46, 0x6c, 0x6f, 0x61, 0x74, 0x00, 0x07, 0x07,
  0x61, 0x72, 0x64, 0x75, 0x69, 0x6e, 0x6f, 0x08, 0x70, 0x72, 0x69, 0x6e,
  0x74, 0x49, 0x6e, 0x74, 0x00, 0x01, 0x07, 0x61, 0x72, 0x64, 0x75, 0x69,
  0x6e, 0x6f, 0x0a, 0x73, 0x74, 0x6f, 0x70, 0x41, 0x64, 0x76, 0x42, 0x4c,
  0x45, 0x00, 0x02, 0x07, 0x61, 0x72, 0x64, 0x75, 0x69, 0x6e, 0x6f, 0x08,
  0x61, 0x64, 0x76, 0x42, 0x4c, 0x45, 0x54, 0x73, 0x00, 0x01, 0x07, 0x61,
  0x72, 0x64, 0x75, 0x69, 0x6e, 0x6f, 0x07, 0x62, 0x6c, 0x65, 0x50, 0x6f,
  0x6f, 0x6c, 0x00, 0x02, 0x07, 0x61, 0x72, 0x64, 0x75, 0x69, 0x6e, 0x6f,
  0x09, 0x67, 0x65, 0x74, 0x50, 0x69, 0x6e, 0x4c, 0x45, 0x44, 0x00, 0x08,
  0x03, 0x0c, 0x0b, 0x00, 0x00, 0x04, 0x09, 0x00, 0x01, 0x04, 0x01, 0x05,
  0x05, 0x02, 0x04, 0x05, 0x01, 0x70, 0x01, 0x03, 0x03, 0x05, 0x04, 0x01,
  0x01, 0x01, 0x01, 0x06, 0x07, 0x01, 0x7f, 0x01, 0x41, 0x80, 0x10, 0x0b,
  0x07, 0x36, 0x06, 0x06, 0x6d, 0x65, 0x6d, 0x6f, 0x72, 0x79, 0x02, 0x00,
  0x06, 0x6d, 0x61, 0x6c, 0x6c, 0x6f, 0x63, 0x00, 0x10, 0x04, 0x66, 0x72,
  0x65, 0x65, 0x00, 0x11, 0x06, 0x63, 0x61, 0x6c, 0x6c, 0x6f, 0x63, 0x00,
  0x12, 0x07, 0x72, 0x65, 0x61, 0x6c, 0x6c, 0x6f, 0x63, 0x00, 0x13, 0x06,
  0x5f, 0x73, 0x74, 0x61, 0x72, 0x74, 0x00, 0x14, 0x09, 0x08, 0x01, 0x00,
  0x41, 0x01, 0x0b, 0x02, 0x0a, 0x0b, 0x0c, 0x01, 0x01, 0x0a, 0xcd, 0x25,
  0x0b, 0x58, 0x01, 0x02, 0x7f, 0x20, 0x02, 0x45, 0x04, 0x40, 0x41, 0x01,
  0x0f, 0x0b, 0x20, 0x00, 0x2d, 0x00, 0x00, 0x20, 0x01, 0x2d, 0x00, 0x00,
  0x46, 0x04, 0x7f, 0x41, 0x01, 0x21, 0x03, 0x02, 0x7f, 0x03, 0x40, 0x20,
  0x02, 0x20, 0x02, 0x20, 0x03, 0x46, 0x0d, 0x01, 0x1a, 0x20, 0x01, 0x20,
  0x03, 0x6a, 0x21, 0x04, 0x20, 0x00, 0x20, 0x03, 0x6a, 0x20, 0x03, 0x41,
  0x01, 0x6a, 0x21, 0x03, 0x2d, 0x00, 0x00, 0x20, 0x04, 0x2d, 0x00, 0x00,
  0x46, 0x0d, 0x00, 0x0b, 0x20, 0x03, 0x41, 0x01, 0x6b, 0x0b, 0x20, 0x02,
  0x4f, 0x05, 0x41, 0x00, 0x0b, 0x0b, 0xbc, 0x01, 0x01, 0x02, 0x7f, 0x20,
  0x02, 0x41, 0xc5, 0xbb, 0xf2, 0x88, 0x78, 0x6c, 0x21, 0x02, 0x02, 0x40,
  0x20, 0x01, 0x45, 0x0d, 0x00, 0x20, 0x01, 0x41, 0x03, 0x71, 0x21, 0x04,
  0x02, 0x40, 0x20, 0x01, 0x41, 0x04, 0x49, 0x04, 0x40, 0x41, 0x00, 0x21,
  0x03, 0x0c, 0x01, 0x0b, 0x20, 0x01, 0x41, 0x7c, 0x71, 0x21, 0x05, 0x41,
  0x00, 0x21, 0x03, 0x03, 0x40, 0x20, 0x02, 0x20, 0x00, 0x20, 0x03, 0x6a,
  0x22, 0x01, 0x2d, 0x00, 0x00, 0x73, 0x41, 0x93, 0x83, 0x80, 0x08, 0x6c,
  0x20, 0x01, 0x41, 0x01, 0x6a, 0x2d, 0x00, 0x00, 0x73, 0x41, 0x93, 0x83,
  0x80, 0x08, 0x6c, 0x20, 0x01, 0x41, 0x02, 0x6a, 0x2d, 0x00, 0x00, 0x73,
  0x41, 0x93, 0x83, 0x80, 0x08, 0x6c, 0x20, 0x01, 0x41, 0x03, 0x6a, 0x2d,
  0x00, 0x00, 0x73, 0x41, 0x93, 0x83, 0x80, 0x08, 0x6c, 0x21, 0x02, 0x20,
  0x05, 0x20, 0x03, 0x41, 0x04, 0x6a, 0x22, 0x03, 0x47, 0x0d, 0x00, 0x0b,
  0x0b, 0x20, 0x04, 0x45, 0x0d, 0x00, 0x20, 0x00, 0x20, 0x03, 0x6a, 0x21,
  0x01, 0x03, 0x40, 0x20, 0x02, 0x20, 0x01, 0x2d, 0x00, 0x00, 0x73, 0x41,
  0x93, 0x83, 0x80, 0x08, 0x6c, 0x21, 0x02, 0x20, 0x01, 0x41, 0x01, 0x6a,
  0x21, 0x01, 0x20, 0x04, 0x41, 0x01, 0x6b, 0x22, 0x04, 0x0d, 0x00, 0x0b,
  0x0b, 0x20, 0x02, 0x0b, 0x7e, 0x01, 0x02, 0x7f, 0x41, 0xc0, 0x10, 0x41,
  0xc0, 0x10, 0x29, 0x03, 0x00, 0x42, 0x01, 0x7c, 0x37, 0x03, 0x00, 0x41,
  0x84, 0x10, 0x41, 0x84, 0x10, 0x28, 0x02, 0x00, 0x22, 0x02, 0x20, 0x00,
  0x41, 0x0f, 0x6a, 0x41, 0x70, 0x71, 0x22, 0x00, 0x6a, 0x22, 0x01, 0x36,
  0x02, 0x00, 0x41, 0xb8, 0x10, 0x41, 0xb8, 0x10, 0x29, 0x03, 0x00, 0x20,
  0x00, 0xad, 0x7c, 0x37, 0x03, 0x00, 0x02, 0x40, 0x41, 0xb0, 0x10, 0x28,
  0x02, 0x00, 0x20, 0x01, 0x4d, 0x04, 0x40, 0x03, 0x40, 0x3f, 0x00, 0x40,
  0x00, 0x41, 0x7f, 0x46, 0x0d, 0x02, 0x41, 0xb0, 0x10, 0x3f, 0x00, 0x41,
  0x10, 0x74, 0x22, 0x01, 0x36, 0x02, 0x00, 0x41, 0x84, 0x10, 0x28, 0x02,
  0x00, 0x20, 0x01, 0x4f, 0x0d, 0x00, 0x0b, 0x0b, 0x20, 0x02, 0x41, 0x00,
  0x20, 0x00, 0xfc, 0x0b, 0x00, 0x20, 0x02, 0x0f, 0x0b, 0x00, 0x0b, 0x97,
  0x08, 0x01, 0x0d, 0x7f, 0x23, 0x00, 0x41, 0x30, 0x6b, 0x22, 0x05, 0x24,
  0x00, 0x02, 0x40, 0x20, 0x00, 0x45, 0x0d, 0x00, 0x02, 0x40, 0x20, 0x00,
  0x2d, 0x00, 0x14, 0x22, 0x04, 0x41, 0x1d, 0x4b, 0x0d, 0x00, 0x20, 0x00,
  0x28, 0x02, 0x08, 0x41, 0x06, 0x20, 0x04, 0x74, 0x4d, 0x0d, 0x00, 0x41,
  0x80, 0x10, 0x41, 0x80, 0x10, 0x28, 0x02, 0x00, 0x22, 0x03, 0x41, 0x07,
  0x74, 0x20, 0x03, 0x73, 0x22, 0x03, 0x41, 0x01, 0x76, 0x20, 0x03, 0x73,
  0x22, 0x03, 0x41, 0x09, 0x74, 0x20, 0x03, 0x73, 0x22, 0x03, 0x36, 0x02,
  0x00, 0x20, 0x05, 0x41, 0x00, 0x36, 0x02, 0x1c, 0x20, 0x05, 0x41, 0x00,
  0x36, 0x02, 0x10, 0x20, 0x05, 0x20, 0x00, 0x29, 0x02, 0x20, 0x37, 0x02,
  0x28, 0x20, 0x05, 0x20, 0x00, 0x29, 0x02, 0x18, 0x37, 0x02, 0x20, 0x20,
  0x05, 0x20, 0x00, 0x29, 0x02, 0x0c, 0x37, 0x02, 0x14, 0x20, 0x05, 0x20,
  0x03, 0x36, 0x02, 0x0c, 0x20, 0x05, 0x20, 0x04, 0x41, 0x01, 0x6a, 0x22,
  0x03, 0x3a, 0x00, 0x1c, 0x20, 0x05, 0x20, 0x00, 0x28, 0x02, 0x10, 0x20,
  0x00, 0x28, 0x02, 0x0c, 0x6a, 0x41, 0x03, 0x74, 0x41, 0x0c, 0x6a, 0x20,
  0x03, 0x74, 0x10, 0x0c, 0x36, 0x02, 0x08, 0x20, 0x00, 0x28, 0x02, 0x0c,
  0x10, 0x0c, 0x21, 0x08, 0x20, 0x00, 0x28, 0x02, 0x10, 0x10, 0x0c, 0x21,
  0x09, 0x41, 0x00, 0x21, 0x04, 0x41, 0x00, 0x21, 0x03, 0x03, 0x40, 0x20,
  0x06, 0x45, 0x04, 0x40, 0x41, 0x01, 0x20, 0x00, 0x2d, 0x00, 0x14, 0x22,
  0x06, 0x74, 0x41, 0x00, 0x20, 0x06, 0x41, 0x1f, 0x4d, 0x1b, 0x21, 0x0c,
  0x20, 0x00, 0x28, 0x02, 0x00, 0x21, 0x06, 0x0b, 0x02, 0x40, 0x03, 0x40,
  0x20, 0x04, 0x41, 0xff, 0x01, 0x71, 0x41, 0x08, 0x4f, 0x04, 0x40, 0x20,
  0x03, 0x45, 0x0d, 0x05, 0x41, 0x00, 0x21, 0x04, 0x20, 0x03, 0x28, 0x02,
  0x08, 0x21, 0x03, 0x0b, 0x20, 0x03, 0x45, 0x04, 0x40, 0x20, 0x0a, 0x20,
  0x0c, 0x4f, 0x0d, 0x02, 0x20, 0x06, 0x20, 0x00, 0x28, 0x02, 0x10, 0x20,
  0x00, 0x28, 0x02, 0x0c, 0x6a, 0x41, 0x03, 0x74, 0x41, 0x0c, 0x6a, 0x20,
  0x0a, 0x6c, 0x6a, 0x22, 0x03, 0x45, 0x0d, 0x05, 0x20, 0x0a, 0x41, 0x01,
  0x6a, 0x21, 0x0a, 0x0b, 0x20, 0x03, 0x20, 0x04, 0x41, 0xff, 0x01, 0x71,
  0x22, 0x0b, 0x6a, 0x2d, 0x00, 0x00, 0x45, 0x04, 0x40, 0x20, 0x04, 0x41,
  0x01, 0x6a, 0x21, 0x04, 0x0c, 0x01, 0x0b, 0x20, 0x08, 0x20, 0x03, 0x20,
  0x00, 0x28, 0x02, 0x0c, 0x22, 0x07, 0x20, 0x0b, 0x6c, 0x6a, 0x41, 0x0c,
  0x6a, 0x20, 0x07, 0xfc, 0x0a, 0x00, 0x00, 0x02, 0x40, 0x20, 0x00, 0x28,
  0x02, 0x00, 0x20, 0x06, 0x46, 0x04, 0x40, 0x20, 0x09, 0x20, 0x03, 0x20,
  0x07, 0x41, 0x03, 0x74, 0x6a, 0x20, 0x00, 0x28, 0x02, 0x10, 0x22, 0x07,
  0x20, 0x0b, 0x6c, 0x6a, 0x41, 0x0c, 0x6a, 0x20, 0x07, 0xfc, 0x0a, 0x00,
  0x00, 0x20, 0x04, 0x41, 0x01, 0x6a, 0x21, 0x04, 0x0c, 0x01, 0x0b, 0x20,
  0x00, 0x28, 0x02, 0x24, 0x22, 0x0b, 0x45, 0x0d, 0x05, 0x20, 0x04, 0x41,
  0x01, 0x6a, 0x21, 0x04, 0x20, 0x00, 0x20, 0x08, 0x20, 0x09, 0x20, 0x08,
  0x20, 0x07, 0x20, 0x00, 0x28, 0x02, 0x04, 0x20, 0x00, 0x28, 0x02, 0x20,
  0x20, 0x0b, 0x11, 0x00, 0x00, 0x10, 0x0e, 0x41, 0x01, 0x71, 0x45, 0x0d,
  0x01, 0x0b, 0x0b, 0x20, 0x05, 0x28, 0x02, 0x2c, 0x22, 0x07, 0x45, 0x0d,
  0x03, 0x20, 0x05, 0x41, 0x08, 0x6a, 0x20, 0x08, 0x20, 0x09, 0x20, 0x08,
  0x20, 0x05, 0x28, 0x02, 0x14, 0x20, 0x05, 0x28, 0x02, 0x0c, 0x20, 0x05,
  0x28, 0x02, 0x28, 0x20, 0x07, 0x11, 0x00, 0x00, 0x10, 0x0d, 0x0c, 0x01,
  0x0b, 0x0b, 0x20, 0x00, 0x20, 0x05, 0x28, 0x02, 0x08, 0x36, 0x02, 0x00,
  0x20, 0x00, 0x20, 0x05, 0x29, 0x02, 0x0c, 0x37, 0x02, 0x04, 0x20, 0x00,
  0x20, 0x05, 0x29, 0x02, 0x14, 0x37, 0x02, 0x0c, 0x20, 0x00, 0x20, 0x05,
  0x2d, 0x00, 0x1c, 0x3a, 0x00, 0x14, 0x20, 0x00, 0x20, 0x05, 0x29, 0x02,
  0x20, 0x37, 0x02, 0x18, 0x20, 0x00, 0x20, 0x05, 0x29, 0x02, 0x28, 0x37,
  0x02, 0x20, 0x20, 0x00, 0x28, 0x02, 0x24, 0x22, 0x03, 0x45, 0x0d, 0x01,
  0x20, 0x01, 0x20, 0x00, 0x28, 0x02, 0x0c, 0x20, 0x00, 0x28, 0x02, 0x04,
  0x20, 0x00, 0x28, 0x02, 0x20, 0x20, 0x03, 0x11, 0x00, 0x00, 0x21, 0x03,
  0x20, 0x00, 0x2d, 0x00, 0x14, 0x21, 0x04, 0x0b, 0x41, 0x01, 0x20, 0x03,
  0x41, 0x18, 0x76, 0x22, 0x06, 0x20, 0x06, 0x41, 0x01, 0x4d, 0x1b, 0x21,
  0x08, 0x02, 0x40, 0x02, 0x40, 0x20, 0x00, 0x28, 0x02, 0x00, 0x20, 0x00,
  0x28, 0x02, 0x10, 0x20, 0x00, 0x28, 0x02, 0x0c, 0x6a, 0x41, 0x03, 0x74,
  0x41, 0x0c, 0x6a, 0x22, 0x06, 0x20, 0x03, 0x41, 0x7f, 0x41, 0x7f, 0x20,
  0x04, 0x41, 0xff, 0x01, 0x71, 0x22, 0x03, 0x74, 0x41, 0x7f, 0x73, 0x20,
  0x03, 0x41, 0x1f, 0x4b, 0x1b, 0x71, 0x6c, 0x6a, 0x22, 0x03, 0x04, 0x7f,
  0x41, 0x00, 0x21, 0x06, 0x41, 0x00, 0x21, 0x09, 0x41, 0x00, 0x21, 0x04,
  0x03, 0x40, 0x20, 0x03, 0x22, 0x0d, 0x41, 0x0c, 0x6a, 0x21, 0x0a, 0x41,
  0x00, 0x21, 0x03, 0x03, 0x40, 0x20, 0x0a, 0x20, 0x00, 0x28, 0x02, 0x0c,
  0x22, 0x07, 0x20, 0x03, 0x6c, 0x6a, 0x21, 0x0b, 0x20, 0x0a, 0x20, 0x07,
  0x41, 0x03, 0x74, 0x6a, 0x20, 0x00, 0x28, 0x02, 0x10, 0x20, 0x03, 0x6c,
  0x6a, 0x21, 0x0c, 0x02, 0x40, 0x20, 0x03, 0x20, 0x0d, 0x6a, 0x22, 0x0e,
  0x2d, 0x00, 0x00, 0x22, 0x0f, 0x20, 0x08, 0x47, 0x0d, 0x00, 0x20, 0x00,
  0x28, 0x02, 0x1c, 0x22, 0x10, 0x45, 0x0d, 0x06, 0x20, 0x01, 0x20, 0x0b,
  0x20, 0x07, 0x20, 0x00, 0x28, 0x02, 0x18, 0x20, 0x10, 0x11, 0x00, 0x00,
  0x41, 0x01, 0x71, 0x45, 0x0d, 0x00, 0x20, 0x0c, 0x20, 0x02, 0x20, 0x00,
  0x28, 0x02, 0x10, 0xfc, 0x0a, 0x00, 0x00, 0x0c, 0x05, 0x0b, 0x20, 0x06,
  0x20, 0x0e, 0x20, 0x04, 0x20, 0x0f, 0x72, 0x22, 0x07, 0x1b, 0x21, 0x06,
  0x20, 0x04, 0x20, 0x0b, 0x20, 0x07, 0x1b, 0x21, 0x04, 0x20, 0x09, 0x20,
  0x0c, 0x20, 0x07, 0x1b, 0x21, 0x09, 0x20, 0x03, 0x41, 0x01, 0x6a, 0x22,
  0x03, 0x41, 0x08, 0x47, 0x0d, 0x00, 0x0b, 0x20, 0x0d, 0x28, 0x02, 0x08,
  0x22, 0x03, 0x0d, 0x00, 0x0b, 0x20, 0x00, 0x28, 0x02, 0x0c, 0x21, 0x03,
  0x20, 0x04, 0x0d, 0x01, 0x20, 0x00, 0x28, 0x02, 0x10, 0x20, 0x03, 0x6a,
  0x41, 0x03, 0x74, 0x41, 0x0c, 0x6a, 0x05, 0x20, 0x06, 0x0b, 0x10, 0x0c,
  0x21, 0x03, 0x20, 0x00, 0x20, 0x00, 0x28, 0x02, 0x08, 0x41, 0x01, 0x6a,
  0x36, 0x02, 0x08, 0x20, 0x03, 0x41, 0x0c, 0x6a, 0x22, 0x04, 0x20, 0x01,
  0x20, 0x00, 0x28, 0x02, 0x0c, 0x22, 0x01, 0xfc, 0x0a, 0x00, 0x00, 0x20,
  0x04, 0x20, 0x01, 0x41, 0x03, 0x74, 0x6a, 0x20, 0x02, 0x20, 0x00, 0x28,
  0x02, 0x10, 0xfc, 0x0a, 0x00, 0x00, 0x20, 0x03, 0x20, 0x08, 0x3a, 0x00,
  0x00, 0x20, 0x0d, 0x45, 0x0d, 0x02, 0x20, 0x0d, 0x20, 0x03, 0x36, 0x02,
  0x08, 0x0c, 0x01, 0x0b, 0x20, 0x00, 0x20, 0x00, 0x28, 0x02, 0x08, 0x41,
  0x01, 0x6a, 0x36, 0x02, 0x08, 0x20, 0x04, 0x20, 0x01, 0x20, 0x03, 0xfc,
  0x0a, 0x00, 0x00, 0x20, 0x09, 0x20, 0x02, 0x20, 0x00, 0x28, 0x02, 0x10,
  0xfc, 0x0a, 0x00, 0x00, 0x20, 0x06, 0x45, 0x0d, 0x01, 0x20, 0x06, 0x20,
  0x08, 0x3a, 0x00, 0x00, 0x0b, 0x20, 0x05, 0x41, 0x30, 0x6a, 0x24, 0x00,
  0x0f, 0x0b, 0x00, 0x0b, 0xb9, 0x05, 0x01, 0x06, 0x7f, 0x02, 0x40, 0x02,
  0x40, 0x20, 0x00, 0x45, 0x0d, 0x00, 0x20, 0x02, 0x41, 0x00, 0x20, 0x00,
  0x28, 0x02, 0x00, 0x20, 0x00, 0x28, 0x02, 0x10, 0x22, 0x06, 0x20, 0x00,
  0x28, 0x02, 0x0c, 0x6a, 0x41, 0x03, 0x74, 0x41, 0x0c, 0x6a, 0x41, 0x7f,
  0x41, 0x7f, 0x20, 0x00, 0x2d, 0x00, 0x14, 0x22, 0x05, 0x74, 0x41, 0x7f,
  0x73, 0x20, 0x05, 0x41, 0x1f, 0x4b, 0x1b, 0x20, 0x03, 0x71, 0x6c, 0x6a,
  0x22, 0x05, 0x04, 0x7f, 0x41, 0x01, 0x20, 0x03, 0x41, 0x18, 0x76, 0x22,
  0x03, 0x20, 0x03, 0x41, 0x01, 0x4d, 0x1b, 0x21, 0x06, 0x03, 0x40, 0x20,
  0x05, 0x41, 0x0c, 0x6a, 0x21, 0x07, 0x20, 0x00, 0x28, 0x02, 0x10, 0x21,
  0x08, 0x20, 0x00, 0x28, 0x02, 0x0c, 0x21, 0x03, 0x20, 0x06, 0x20, 0x05,
  0x2d, 0x00, 0x00, 0x46, 0x04, 0x40, 0x20, 0x00, 0x28, 0x02, 0x1c, 0x22,
  0x04, 0x45, 0x0d, 0x03, 0x20, 0x01, 0x20, 0x07, 0x20, 0x03, 0x20, 0x00,
  0x28, 0x02, 0x18, 0x20, 0x04, 0x11, 0x00, 0x00, 0x41, 0x01, 0x71, 0x04,
  0x40, 0x41, 0x00, 0x21, 0x04, 0x0c, 0x05, 0x0b, 0x20, 0x00, 0x28, 0x02,
  0x10, 0x21, 0x08, 0x20, 0x00, 0x28, 0x02, 0x0c, 0x21, 0x03, 0x0b, 0x20,
  0x06, 0x20, 0x05, 0x2d, 0x00, 0x01, 0x46, 0x04, 0x40, 0x20, 0x00, 0x28,
  0x02, 0x1c, 0x22, 0x09, 0x45, 0x0d, 0x03, 0x41, 0x01, 0x21, 0x04, 0x20,
  0x01, 0x20, 0x03, 0x20, 0x07, 0x6a, 0x20, 0x03, 0x20, 0x00, 0x28, 0x02,
  0x18, 0x20, 0x09, 0x11, 0x00, 0x00, 0x41, 0x01, 0x71, 0x0d, 0x04, 0x20,
  0x00, 0x28, 0x02, 0x10, 0x21, 0x08, 0x20, 0x00, 0x28, 0x02, 0x0c, 0x21,
  0x03, 0x0b, 0x20, 0x06, 0x20, 0x05, 0x2d, 0x00, 0x02, 0x46, 0x04, 0x40,
  0x20, 0x00, 0x28, 0x02, 0x1c, 0x22, 0x04, 0x45, 0x0d, 0x03, 0x20, 0x01,
  0x20, 0x07, 0x20, 0x03, 0x41, 0x01, 0x74, 0x6a, 0x20, 0x03, 0x20, 0x00,
  0x28, 0x02, 0x18, 0x20, 0x04, 0x11, 0x00, 0x00, 0x41, 0x01, 0x71, 0x04,
  0x40, 0x41, 0x02, 0x21, 0x04, 0x0c, 0x05, 0x0b, 0x20, 0x00, 0x28, 0x02,
  0x10, 0x21, 0x08, 0x20, 0x00, 0x28, 0x02, 0x0c, 0x21, 0x03, 0x0b, 0x20,
  0x06, 0x20, 0x05, 0x2d, 0x00, 0x03, 0x46, 0x04, 0x40, 0x20, 0x00, 0x28,
  0x02, 0x1c, 0x22, 0x04, 0x45, 0x0d, 0x03, 0x20, 0x01, 0x20, 0x07, 0x20,
  0x03, 0x41, 0x03, 0x6c, 0x6a, 0x20, 0x03, 0x20, 0x00, 0x28, 0x02, 0x18,
  0x20, 0x04, 0x11, 0x00, 0x00, 0x41, 0x01, 0x71, 0x04, 0x40, 0x41, 0x03,
  0x21, 0x04, 0x0c, 0x05, 0x0b, 0x20, 0x00, 0x28, 0x02, 0x10, 0x21, 0x08,
  0x20, 0x00, 0x28, 0x02, 0x0c, 0x21, 0x03, 0x0b, 0x20, 0x06, 0x20, 0x05,
  0x2d, 0x00, 0x04, 0x46, 0x04, 0x40, 0x20, 0x00, 0x28, 0x02, 0x1c, 0x22,
  0x04, 0x45, 0x0d, 0x03, 0x20, 0x01, 0x20, 0x07, 0x20, 0x03, 0x41, 0x02,
  0x74, 0x6a, 0x20, 0x03, 0x20, 0x00, 0x28, 0x02, 0x18, 0x20, 0x04, 0x11,
  0x00, 0x00, 0x41, 0x01, 0x71, 0x04, 0x40, 0x41, 0x04, 0x21, 0x04, 0x0c,
  0x05, 0x0b, 0x20, 0x00, 0x28, 0x02, 0x10, 0x21, 0x08, 0x20, 0x00, 0x28,
  0x02, 0x0c, 0x21, 0x03, 0x0b, 0x20, 0x06, 0x20, 0x05, 0x2d, 0x00, 0x05,
  0x46, 0x04, 0x40, 0x20, 0x00, 0x28, 0x02, 0x1c, 0x22, 0x04, 0x45, 0x0d,
  0x03, 0x20, 0x01, 0x20, 0x07, 0x20, 0x03, 0x41, 0x05, 0x6c, 0x6a, 0x20,
  0x03, 0x20, 0x00, 0x28, 0x02, 0x18, 0x20, 0x04, 0x11, 0x00, 0x00, 0x41,
  0x01, 0x71, 0x04, 0x40, 0x41, 0x05, 0x21, 0x04, 0x0c, 0x05, 0x0b, 0x20,
  0x00, 0x28, 0x02, 0x10, 0x21, 0x08, 0x20, 0x00, 0x28, 0x02, 0x0c, 0x21,
  0x03, 0x0b, 0x20, 0x06, 0x20, 0x05, 0x2d, 0x00, 0x06, 0x46, 0x04, 0x40,
  0x20, 0x00, 0x28, 0x02, 0x1c, 0x22, 0x04, 0x45, 0x0d, 0x03, 0x20, 0x01,
  0x20, 0x07, 0x20, 0x03, 0x41, 0x06, 0x6c, 0x6a, 0x20, 0x03, 0x20, 0x00,
  0x28, 0x02, 0x18, 0x20, 0x04, 0x11, 0x00, 0x00, 0x41, 0x01, 0x71, 0x04,
  0x40, 0x41, 0x06, 0x21, 0x04, 0x0c, 0x05, 0x0b, 0x20, 0x00, 0x28, 0x02,
  0x10, 0x21, 0x08, 0x20, 0x00, 0x28, 0x02, 0x0c, 0x21, 0x03, 0x0b, 0x02,
  0x40, 0x20, 0x05, 0x2d, 0x00, 0x07, 0x20, 0x06, 0x47, 0x0d, 0x00, 0x20,
  0x00, 0x28, 0x02, 0x1c, 0x22, 0x04, 0x45, 0x0d, 0x03, 0x20, 0x01, 0x20,
  0x07, 0x20, 0x03, 0x41, 0x07, 0x6c, 0x6a, 0x20, 0x03, 0x20, 0x00, 0x28,
  0x02, 0x18, 0x20, 0x04, 0x11, 0x00, 0x00, 0x41, 0x01, 0x71, 0x45, 0x0d,
  0x00, 0x41, 0x07, 0x21, 0x04, 0x0c, 0x04, 0x0b, 0x20, 0x05, 0x28, 0x02,
  0x08, 0x22, 0x05, 0x0d, 0x00, 0x0b, 0x20, 0x00, 0x28, 0x02, 0x10, 0x05,
  0x20, 0x06, 0x0b, 0xfc, 0x0b, 0x00, 0x41, 0x00, 0x0f, 0x0b, 0x00, 0x0b,
  0x20, 0x02, 0x20, 0x05, 0x20, 0x03, 0x41, 0x03, 0x74, 0x6a, 0x20, 0x04,
  0x20, 0x08, 0x6c, 0x6a, 0x41, 0x0c, 0x6a, 0x20, 0x00, 0x28, 0x02, 0x10,
  0xfc, 0x0a, 0x00, 0x00, 0x41, 0x01, 0x0b, 0xf0, 0x06, 0x01, 0x07, 0x7f,
  0x41, 0x8c, 0x10, 0x28, 0x02, 0x00, 0x41, 0xc5, 0xbb, 0xf2, 0x88, 0x78,
  0x6c, 0x21, 0x05, 0x02, 0x40, 0x41, 0x94, 0x10, 0x28, 0x02, 0x00, 0x22,
  0x01, 0x45, 0x0d, 0x00, 0x20, 0x01, 0x41, 0x03, 0x71, 0x21, 0x04, 0x20,
  0x01, 0x41, 0x04, 0x4f, 0x04, 0x40, 0x20, 0x01, 0x41, 0x7c, 0x71, 0x21,
  0x06, 0x03, 0x40, 0x20, 0x05, 0x20, 0x00, 0x20, 0x03, 0x6a, 0x22, 0x02,
  0x2d, 0x00, 0x00, 0x73, 0x41, 0x93, 0x83, 0x80, 0x08, 0x6c, 0x20, 0x02,
  0x41, 0x01, 0x6a, 0x2d, 0x00, 0x00, 0x73, 0x41, 0x93, 0x83, 0x80, 0x08,
  0x6c, 0x20, 0x02, 0x41, 0x02, 0x6a, 0x2d, 0x00, 0x00, 0x73, 0x41, 0x93,
  0x83, 0x80, 0x08, 0x6c, 0x20, 0x02, 0x41, 0x03, 0x6a, 0x2d, 0x00, 0x00,
  0x73, 0x41, 0x93, 0x83, 0x80, 0x08, 0x6c, 0x21, 0x05, 0x20, 0x06, 0x20,
  0x03, 0x41, 0x04, 0x6a, 0x22, 0x03, 0x47, 0x0d, 0x00, 0x0b, 0x0b, 0x20,
  0x04, 0x45, 0x0d, 0x00, 0x20, 0x00, 0x20, 0x03, 0x6a, 0x21, 0x03, 0x03,
  0x40, 0x20, 0x05, 0x20, 0x03, 0x2d, 0x00, 0x00, 0x73, 0x41, 0x93, 0x83,
  0x80, 0x08, 0x6c, 0x21, 0x05, 0x20, 0x03, 0x41, 0x01, 0x6a, 0x21, 0x03,
  0x20, 0x04, 0x41, 0x01, 0x6b, 0x22, 0x04, 0x0d, 0x00, 0x0b, 0x0b, 0x02,
  0x40, 0x02, 0x40, 0x02, 0x40, 0x41, 0x88, 0x10, 0x28, 0x02, 0x00, 0x41,
  0x98, 0x10, 0x28, 0x02, 0x00, 0x20, 0x01, 0x6a, 0x41, 0x03, 0x74, 0x41,
  0x0c, 0x6a, 0x41, 0x7f, 0x41, 0x7f, 0x41, 0x9c, 0x10, 0x2d, 0x00, 0x00,
  0x22, 0x04, 0x74, 0x41, 0x7f, 0x73, 0x20, 0x04, 0x41, 0x1f, 0x4b, 0x1b,
  0x20, 0x05, 0x71, 0x6c, 0x6a, 0x22, 0x03, 0x04, 0x40, 0x41, 0x01, 0x20,
  0x05, 0x41, 0x18, 0x76, 0x22, 0x04, 0x20, 0x04, 0x41, 0x01, 0x4d, 0x1b,
  0x21, 0x06, 0x03, 0x40, 0x20, 0x03, 0x41, 0x0c, 0x6a, 0x21, 0x05, 0x20,
  0x06, 0x20, 0x03, 0x2d, 0x00, 0x00, 0x46, 0x04, 0x40, 0x41, 0xa4, 0x10,
  0x28, 0x02, 0x00, 0x22, 0x04, 0x45, 0x0d, 0x04, 0x41, 0x00, 0x21, 0x02,
  0x20, 0x00, 0x20, 0x05, 0x20, 0x01, 0x41, 0xa0, 0x10, 0x28, 0x02, 0x00,
  0x20, 0x04, 0x11, 0x00, 0x00, 0x41, 0x01, 0x71, 0x04, 0x40, 0x20, 0x05,
  0x21, 0x04, 0x0c, 0x06, 0x0b, 0x41, 0x94, 0x10, 0x28, 0x02, 0x00, 0x21,
  0x01, 0x0b, 0x20, 0x06, 0x20, 0x03, 0x2d, 0x00, 0x01, 0x46, 0x04, 0x40,
  0x41, 0xa4, 0x10, 0x28, 0x02, 0x00, 0x22, 0x07, 0x45, 0x0d, 0x04, 0x41,
  0x01, 0x21, 0x02, 0x20, 0x00, 0x20, 0x01, 0x20, 0x05, 0x6a, 0x22, 0x04,
  0x20, 0x01, 0x41, 0xa0, 0x10, 0x28, 0x02, 0x00, 0x20, 0x07, 0x11, 0x00,
  0x00, 0x41, 0x01, 0x71, 0x0d, 0x05, 0x41, 0x94, 0x10, 0x28, 0x02, 0x00,
  0x21, 0x01, 0x0b, 0x20, 0x06, 0x20, 0x03, 0x2d, 0x00, 0x02, 0x46, 0x04,
  0x40, 0x41, 0xa4, 0x10, 0x28, 0x02, 0x00, 0x22, 0x02, 0x45, 0x0d, 0x04,
  0x20, 0x00, 0x20, 0x05, 0x20, 0x01, 0x41, 0x01, 0x74, 0x6a, 0x22, 0x04,
  0x20, 0x01, 0x41, 0xa0, 0x10, 0x28, 0x02, 0x00, 0x20, 0x02, 0x11, 0x00,
  0x00, 0x41, 0x01, 0x71, 0x04, 0x40, 0x41, 0x02, 0x21, 0x02, 0x0c, 0x06,
  0x0b, 0x41, 0x94, 0x10, 0x28, 0x02, 0x00, 0x21, 0x01, 0x0b, 0x20, 0x06,
  0x20, 0x03, 0x2d, 0x00, 0x03, 0x46, 0x04, 0x40, 0x41, 0xa4, 0x10, 0x28,
  0x02, 0x00, 0x22, 0x02, 0x45, 0x0d, 0x04, 0x20, 0x00, 0x20, 0x05, 0x20,
  0x01, 0x41, 0x03, 0x6c, 0x6a, 0x22, 0x04, 0x20, 0x01, 0x41, 0xa0, 0x10,
  0x28, 0x02, 0x00, 0x20, 0x02, 0x11, 0x00, 0x00, 0x41, 0x01, 0x71, 0x04,
  0x40, 0x41, 0x03, 0x21, 0x02, 0x0c, 0x06, 0x0b, 0x41, 0x94, 0x10, 0x28,
  0x02, 0x00, 0x21, 0x01, 0x0b, 0x20, 0x06, 0x20, 0x03, 0x2d, 0x00, 0x04,
  0x46, 0x04, 0x40, 0x41, 0xa4, 0x10, 0x28, 0x02, 0x00, 0x22, 0x02, 0x45,
  0x0d, 0x04, 0x20, 0x00, 0x20, 0x05, 0x20, 0x01, 0x41, 0x02, 0x74, 0x6a,
  0x22, 0x04, 0x20, 0x01, 0x41, 0xa0, 0x10, 0x28, 0x02, 0x00, 0x20, 0x02,
  0x11, 0x00, 0x00, 0x41, 0x01, 0x71, 0x04, 0x40, 0x41, 0x04, 0x21, 0x02,
  0x0c, 0x06, 0x0b, 0x41, 0x94, 0x10, 0x28, 0x02, 0x00, 0x21, 0x01, 0x0b,
  0x20, 0x06, 0x20, 0x03, 0x2d, 0x00, 0x05, 0x46, 0x04, 0x40, 0x41, 0xa4,
  0x10, 0x28, 0x02, 0x00, 0x22, 0x02, 0x45, 0x0d, 0x04, 0x20, 0x00, 0x20,
  0x05, 0x20, 0x01, 0x41, 0x05, 0x6c, 0x6a, 0x22, 0x04, 0x20, 0x01, 0x41,
  0xa0, 0x10, 0x28, 0x02, 0x00, 0x20, 0x02, 0x11, 0x00, 0x00, 0x41, 0x01,
  0x71, 0x04, 0x40, 0x41, 0x05, 0x21, 0x02, 0x0c, 0x06, 0x0b, 0x41, 0x94,
  0x10, 0x28, 0x02, 0x00, 0x21, 0x01, 0x0b, 0x20, 0x06, 0x20, 0x03, 0x2d,
  0x00, 0x06, 0x46, 0x04, 0x40, 0x41, 0xa4, 0x10, 0x28, 0x02, 0x00, 0x22,
  0x02, 0x45, 0x0d, 0x04, 0x20, 0x00, 0x20, 0x05, 0x20, 0x01, 0x41, 0x06,
  0x6c, 0x6a, 0x22, 0x04, 0x20, 0x01, 0x41, 0xa0, 0x10, 0x28, 0x02, 0x00,
  0x20, 0x02, 0x11, 0x00, 0x00, 0x41, 0x01, 0x71, 0x04, 0x40, 0x41, 0x06,
  0x21, 0x02, 0x0c, 0x06, 0x0b, 0x41, 0x94, 0x10, 0x28, 0x02, 0x00, 0x21,
  0x01, 0x0b, 0x20, 0x06, 0x20, 0x03, 0x2d, 0x00, 0x07, 0x46, 0x04, 0x40,
  0x41, 0xa4, 0x10, 0x28, 0x02, 0x00, 0x22, 0x02, 0x45, 0x0d, 0x04, 0x20,
  0x00, 0x20, 0x05, 0x20, 0x01, 0x41, 0x07, 0x6c, 0x6a, 0x22, 0x04, 0x20,
  0x01, 0x41, 0xa0, 0x10, 0x28, 0x02, 0x00, 0x20, 0x02, 0x11, 0x00, 0x00,
  0x41, 0x01, 0x71, 0x0d, 0x03, 0x41, 0x94, 0x10, 0x28, 0x02, 0x00, 0x21,
  0x01, 0x0b, 0x20, 0x03, 0x28, 0x02, 0x08, 0x22, 0x03, 0x0d, 0x00, 0x0b,
  0x0b, 0x0f, 0x0b, 0x41, 0x07, 0x21, 0x02, 0x0c, 0x01, 0x0b, 0x00, 0x0b,
  0x20, 0x02, 0x20, 0x03, 0x6a, 0x41, 0x00, 0x3a, 0x00, 0x00, 0x20, 0x04,
  0x41, 0x00, 0x41, 0x94, 0x10, 0x28, 0x02, 0x00, 0xfc, 0x0b, 0x00, 0x20,
  0x03, 0x41, 0x94, 0x10, 0x28, 0x02, 0x00, 0x41, 0x03, 0x74, 0x6a, 0x41,
  0x98, 0x10, 0x28, 0x02, 0x00, 0x22, 0x00, 0x20, 0x02, 0x6c, 0x6a, 0x41,
  0x0c, 0x6a, 0x41, 0x00, 0x20, 0x00, 0xfc, 0x0b, 0x00, 0x41, 0x90, 0x10,
  0x41, 0x90, 0x10, 0x28, 0x02, 0x00, 0x41, 0x01, 0x6b, 0x36, 0x02, 0x00,
  0x0b, 0x92, 0x02, 0x01, 0x06, 0x7f, 0x23, 0x00, 0x41, 0x10, 0x6b, 0x22,
  0x02, 0x24, 0x00, 0x02, 0x40, 0x20, 0x00, 0x45, 0x0d, 0x00, 0x20, 0x00,
  0x41, 0x00, 0x4e, 0x04, 0x40, 0x20, 0x00, 0x10, 0x0c, 0x21, 0x03, 0x20,
  0x02, 0x20, 0x00, 0x36, 0x02, 0x08, 0x20, 0x02, 0x20, 0x00, 0x36, 0x02,
  0x04, 0x20, 0x02, 0x20, 0x03, 0x36, 0x02, 0x00, 0x20, 0x02, 0x20, 0x03,
  0x36, 0x02, 0x0c, 0x41, 0x8c, 0x10, 0x28, 0x02, 0x00, 0x41, 0xc5, 0xbb,
  0xf2, 0x88, 0x78, 0x6c, 0x21, 0x00, 0x02, 0x40, 0x41, 0x94, 0x10, 0x28,
  0x02, 0x00, 0x22, 0x01, 0x45, 0x0d, 0x00, 0x20, 0x01, 0x41, 0x03, 0x71,
  0x21, 0x04, 0x20, 0x01, 0x41, 0x04, 0x4f, 0x04, 0x40, 0x20, 0x01, 0x41,
  0x7c, 0x71, 0x21, 0x06, 0x03, 0x40, 0x20, 0x00, 0x20, 0x02, 0x41, 0x0c,
  0x6a, 0x20, 0x05, 0x6a, 0x22, 0x01, 0x2d, 0x00, 0x00, 0x73, 0x41, 0x93,
  0x83, 0x80, 0x08, 0x6c, 0x20, 0x01, 0x41, 0x01, 0x6a, 0x2d, 0x00, 0x00,
  0x73, 0x41, 0x93, 0x83, 0x80, 0x08, 0x6c, 0x20, 0x01, 0x41, 0x02, 0x6a,
  0x2d, 0x00, 0x00, 0x73, 0x41, 0x93, 0x83, 0x80, 0x08, 0x6c, 0x20, 0x01,
  0x41, 0x03, 0x6a, 0x2d, 0x00, 0x00, 0x73, 0x41, 0x93, 0x83, 0x80, 0x08,
  0x6c, 0x21, 0x00, 0x20, 0x06, 0x20, 0x05, 0x41, 0x04, 0x6a, 0x22, 0x05,
  0x47, 0x0d, 0x00, 0x0b, 0x0b, 0x20, 0x04, 0x45, 0x0d, 0x00, 0x20, 0x02,
  0x41, 0x0c, 0x6a, 0x20, 0x05, 0x6a, 0x21, 0x01, 0x03, 0x40, 0x20, 0x00,
  0x20, 0x01, 0x2d, 0x00, 0x00, 0x73, 0x41, 0x93, 0x83, 0x80, 0x08, 0x6c,
  0x21, 0x00, 0x20, 0x01, 0x41, 0x01, 0x6a, 0x21, 0x01, 0x20, 0x04, 0x41,
  0x01, 0x6b, 0x22, 0x04, 0x0d, 0x00, 0x0b, 0x0b, 0x41, 0x88, 0x10, 0x20,
  0x02, 0x41, 0x0c, 0x6a, 0x20, 0x02, 0x20, 0x00, 0x10, 0x0d, 0x0c, 0x01,
  0x0b, 0x00, 0x0b, 0x20, 0x02, 0x41, 0x10, 0x6a, 0x24, 0x00, 0x20, 0x03,
  0x0b, 0x81, 0x02, 0x01, 0x06, 0x7f, 0x23, 0x00, 0x41, 0x10, 0x6b, 0x22,
  0x02, 0x24, 0x00, 0x02, 0x40, 0x02, 0x40, 0x20, 0x00, 0x04, 0x40, 0x20,
  0x02, 0x20, 0x00, 0x36, 0x02, 0x0c, 0x41, 0x8c, 0x10, 0x28, 0x02, 0x00,
  0x41, 0xc5, 0xbb, 0xf2, 0x88, 0x78, 0x6c, 0x21, 0x03, 0x02, 0x40, 0x41,
  0x94, 0x10, 0x28, 0x02, 0x00, 0x22, 0x01, 0x45, 0x0d, 0x00, 0x20, 0x01,
  0x41, 0x03, 0x71, 0x21, 0x04, 0x20, 0x01, 0x41, 0x04, 0x4f, 0x04, 0x40,
  0x20, 0x01, 0x41, 0x7c, 0x71, 0x21, 0x06, 0x03, 0x40, 0x20, 0x03, 0x20,
  0x02, 0x41, 0x0c, 0x6a, 0x20, 0x05, 0x6a, 0x22, 0x01, 0x2d, 0x00, 0x00,
  0x73, 0x41, 0x93, 0x83, 0x80, 0x08, 0x6c, 0x20, 0x01, 0x41, 0x01, 0x6a,
  0x2d, 0x00, 0x00, 0x73, 0x41, 0x93, 0x83, 0x80, 0x08, 0x6c, 0x20, 0x01,
  0x41, 0x02, 0x6a, 0x2d, 0x00, 0x00, 0x73, 0x41, 0x93, 0x83, 0x80, 0x08,
  0x6c, 0x20, 0x01, 0x41, 0x03, 0x6a, 0x2d, 0x00, 0x00, 0x73, 0x41, 0x93,
  0x83, 0x80, 0x08, 0x6c, 0x21, 0x03, 0x20, 0x06, 0x20, 0x05, 0x41, 0x04,
  0x6a, 0x22, 0x05, 0x47, 0x0d, 0x00, 0x0b, 0x0b, 0x20, 0x04, 0x45, 0x0d,
  0x00, 0x20, 0x02, 0x41, 0x0c, 0x6a, 0x20, 0x05, 0x6a, 0x21, 0x01, 0x03,
  0x40, 0x20, 0x03, 0x20, 0x01, 0x2d, 0x00, 0x00, 0x73, 0x41, 0x93, 0x83,
  0x80, 0x08, 0x6c, 0x21, 0x03, 0x20, 0x01, 0x41, 0x01, 0x6a, 0x21, 0x01,
  0x20, 0x04, 0x41, 0x01, 0x6b, 0x22, 0x04, 0x0d, 0x00, 0x0b, 0x0b, 0x41,
  0x88, 0x10, 0x20, 0x02, 0x41, 0x0c, 0x6a, 0x20, 0x02, 0x20, 0x03, 0x10,
  0x0e, 0x41, 0x01, 0x71, 0x45, 0x0d, 0x01, 0x20, 0x02, 0x20, 0x00, 0x36,
  0x02, 0x00, 0x20, 0x02, 0x10, 0x0f, 0x0b, 0x20, 0x02, 0x41, 0x10, 0x6a,
  0x24, 0x00, 0x0c, 0x01, 0x0b, 0x00, 0x0b, 0x0b, 0x99, 0x02, 0x01, 0x05,
  0x7f, 0x02, 0x7f, 0x23, 0x00, 0x41, 0x10, 0x6b, 0x22, 0x02, 0x24, 0x00,
  0x02, 0x40, 0x20, 0x00, 0x20, 0x01, 0x6c, 0x22, 0x00, 0x04, 0x40, 0x20,
  0x00, 0x41, 0x00, 0x48, 0x0d, 0x01, 0x20, 0x00, 0x10, 0x0c, 0x21, 0x03,
  0x20, 0x02, 0x20, 0x00, 0x36, 0x02, 0x08, 0x20, 0x02, 0x20, 0x00, 0x36,
  0x02, 0x04, 0x20, 0x02, 0x20, 0x03, 0x36, 0x02, 0x00, 0x20, 0x02, 0x20,
  0x03, 0x36, 0x02, 0x0c, 0x41, 0x8c, 0x10, 0x28, 0x02, 0x00, 0x41, 0xc5,
  0xbb, 0xf2, 0x88, 0x78, 0x6c, 0x21, 0x00, 0x02, 0x40, 0x41, 0x94, 0x10,
  0x28, 0x02, 0x00, 0x22, 0x01, 0x45, 0x0d, 0x00, 0x20, 0x01, 0x41, 0x03,
  0x71, 0x21, 0x04, 0x20, 0x01, 0x41, 0x04, 0x4f, 0x04, 0x40, 0x20, 0x01,
  0x41, 0x7c, 0x71, 0x21, 0x06, 0x03, 0x40, 0x20, 0x00, 0x20, 0x02, 0x41,
  0x0c, 0x6a, 0x20, 0x05, 0x6a, 0x22, 0x01, 0x2d, 0x00, 0x00, 0x73, 0x41,
  0x93, 0x83, 0x80, 0x08, 0x6c, 0x20, 0x01, 0x41, 0x01, 0x6a, 0x2d, 0x00,
  0x00, 0x73, 0x41, 0x93, 0x83, 0x80, 0x08, 0x6c, 0x20, 0x01, 0x41, 0x02,
  0x6a, 0x2d, 0x00, 0x00, 0x73, 0x41, 0x93, 0x83, 0x80, 0x08, 0x6c, 0x20,
  0x01, 0x41, 0x03, 0x6a, 0x2d, 0x00, 0x00, 0x73, 0x41, 0x93, 0x83, 0x80,
  0x08, 0x6c, 0x21, 0x00, 0x20, 0x06, 0x20, 0x05, 0x41, 0x04, 0x6a, 0x22,
  0x05, 0x47, 0x0d, 0x00, 0x0b, 0x0b, 0x20, 0x04, 0x45, 0x0d, 0x00, 0x20,
  0x02, 0x41, 0x0c, 0x6a, 0x20, 0x05, 0x6a, 0x21, 0x01, 0x03, 0x40, 0x20,
  0x00, 0x20, 0x01, 0x2d, 0x00, 0x00, 0x73, 0x41, 0x93, 0x83, 0x80, 0x08,
  0x6c, 0x21, 0x00, 0x20, 0x01, 0x41, 0x01, 0x6a, 0x21, 0x01, 0x20, 0x04,
  0x41, 0x01, 0x6b, 0x22, 0x04, 0x0d, 0x00, 0x0b, 0x0b, 0x41, 0x88, 0x10,
  0x20, 0x02, 0x41, 0x0c, 0x6a, 0x20, 0x02, 0x20, 0x00, 0x10, 0x0d, 0x0b,
  0x20, 0x02, 0x41, 0x10, 0x6a, 0x24, 0x00, 0x20, 0x03, 0x0c, 0x01, 0x0b,
  0x00, 0x0b, 0x0b, 0x80, 0x06, 0x01, 0x07, 0x7f, 0x02, 0x7f, 0x23, 0x00,
  0x41, 0x10, 0x6b, 0x22, 0x02, 0x24, 0x00, 0x02, 0x40, 0x02, 0x40, 0x20,
  0x01, 0x45, 0x04, 0x40, 0x20, 0x00, 0x45, 0x0d, 0x01, 0x20, 0x02, 0x20,
  0x00, 0x36, 0x02, 0x0c, 0x41, 0x8c, 0x10, 0x28, 0x02, 0x00, 0x41, 0xc5,
  0xbb, 0xf2, 0x88, 0x78, 0x6c, 0x21, 0x04, 0x02, 0x40, 0x41, 0x94, 0x10,
  0x28, 0x02, 0x00, 0x22, 0x01, 0x45, 0x0d, 0x00, 0x20, 0x01, 0x41, 0x03,
  0x71, 0x21, 0x05, 0x20, 0x01, 0x41, 0x04, 0x4f, 0x04, 0x40, 0x20, 0x01,
  0x41, 0x7c, 0x71, 0x21, 0x06, 0x03, 0x40, 0x20, 0x04, 0x20, 0x02, 0x41,
  0x0c, 0x6a, 0x20, 0x03, 0x6a, 0x22, 0x01, 0x2d, 0x00, 0x00, 0x73, 0x41,
  0x93, 0x83, 0x80, 0x08, 0x6c, 0x20, 0x01, 0x41, 0x01, 0x6a, 0x2d, 0x00,
  0x00, 0x73, 0x41, 0x93, 0x83, 0x80, 0x08, 0x6c, 0x20, 0x01, 0x41, 0x02,
  0x6a, 0x2d, 0x00, 0x00, 0x73, 0x41, 0x93, 0x83, 0x80, 0x08, 0x6c, 0x20,
  0x01, 0x41, 0x03, 0x6a, 0x2d, 0x00, 0x00, 0x73, 0x41, 0x93, 0x83, 0x80,
  0x08, 0x6c, 0x21, 0x04, 0x20, 0x06, 0x20, 0x03, 0x41, 0x04, 0x6a, 0x22,
  0x03, 0x47, 0x0d, 0x00, 0x0b, 0x0b, 0x20, 0x05, 0x45, 0x0d, 0x00, 0x20,
  0x02, 0x41, 0x0c, 0x6a, 0x20, 0x03, 0x6a, 0x21, 0x03, 0x03, 0x40, 0x20,
  0x04, 0x20, 0x03, 0x2d, 0x00, 0x00, 0x73, 0x41, 0x93, 0x83, 0x80, 0x08,
  0x6c, 0x21, 0x04, 0x20, 0x03, 0x41, 0x01, 0x6a, 0x21, 0x03, 0x20, 0x05,
  0x41, 0x01, 0x6b, 0x22, 0x05, 0x0d, 0x00, 0x0b, 0x0b, 0x41, 0x88, 0x10,
  0x20, 0x02, 0x41, 0x0c, 0x6a, 0x20, 0x02, 0x20, 0x04, 0x10, 0x0e, 0x41,
  0x01, 0x71, 0x45, 0x0d, 0x02, 0x20, 0x02, 0x20, 0x00, 0x36, 0x02, 0x00,
  0x20, 0x02, 0x10, 0x0f, 0x0c, 0x01, 0x0b, 0x20, 0x01, 0x41, 0x00, 0x48,
  0x0d, 0x01, 0x20, 0x01, 0x10, 0x0c, 0x21, 0x07, 0x20, 0x00, 0x04, 0x40,
  0x20, 0x02, 0x20, 0x00, 0x36, 0x02, 0x0c, 0x41, 0x8c, 0x10, 0x28, 0x02,
  0x00, 0x41, 0xc5, 0xbb, 0xf2, 0x88, 0x78, 0x6c, 0x21, 0x04, 0x02, 0x40,
  0x41, 0x94, 0x10, 0x28, 0x02, 0x00, 0x22, 0x06, 0x45, 0x0d, 0x00, 0x20,
  0x06, 0x41, 0x03, 0x71, 0x21, 0x05, 0x20, 0x06, 0x41, 0x04, 0x4f, 0x04,
  0x40, 0x20, 0x06, 0x41, 0x7c, 0x71, 0x21, 0x08, 0x03, 0x40, 0x20, 0x04,
  0x20, 0x02, 0x41, 0x0c, 0x6a, 0x20, 0x03, 0x6a, 0x22, 0x06, 0x2d, 0x00,
  0x00, 0x73, 0x41, 0x93, 0x83, 0x80, 0x08, 0x6c, 0x20, 0x06, 0x41, 0x01,
  0x6a, 0x2d, 0x00, 0x00, 0x73, 0x41, 0x93, 0x83, 0x80, 0x08, 0x6c, 0x20,
  0x06, 0x41, 0x02, 0x6a, 0x2d, 0x00, 0x00, 0x73, 0x41, 0x93, 0x83, 0x80,
  0x08, 0x6c, 0x20, 0x06, 0x41, 0x03, 0x6a, 0x2d, 0x00, 0x00, 0x73, 0x41,
  0x93, 0x83, 0x80, 0x08, 0x6c, 0x21, 0x04, 0x20, 0x08, 0x20, 0x03, 0x41,
  0x04, 0x6a, 0x22, 0x03, 0x47, 0x0d, 0x00, 0x0b, 0x0b, 0x20, 0x05, 0x45,
  0x0d, 0x00, 0x20, 0x02, 0x41, 0x0c, 0x6a, 0x20, 0x03, 0x6a, 0x21, 0x03,
  0x03, 0x40, 0x20, 0x04, 0x20, 0x03, 0x2d, 0x00, 0x00, 0x73, 0x41, 0x93,
  0x83, 0x80, 0x08, 0x6c, 0x21, 0x04, 0x20, 0x03, 0x41, 0x01, 0x6a, 0x21,
  0x03, 0x20, 0x05, 0x41, 0x01, 0x6b, 0x22, 0x05, 0x0d, 0x00, 0x0b, 0x0b,
  0x41, 0x88, 0x10, 0x20, 0x02, 0x41, 0x0c, 0x6a, 0x20, 0x02, 0x20, 0x04,
  0x10, 0x0e, 0x41, 0x01, 0x71, 0x45, 0x0d, 0x02, 0x20, 0x07, 0x20, 0x02,
  0x28, 0x02, 0x00, 0x20, 0x02, 0x28, 0x02, 0x04, 0x22, 0x04, 0x20, 0x01,
  0x20, 0x01, 0x20, 0x04, 0x4b, 0x1b, 0xfc, 0x0a, 0x00, 0x00, 0x20, 0x02,
  0x20, 0x00, 0x36, 0x02, 0x00, 0x20, 0x02, 0x10, 0x0f, 0x0b, 0x20, 0x02,
  0x20, 0x01, 0x36, 0x02, 0x08, 0x20, 0x02, 0x20, 0x01, 0x36, 0x02, 0x04,
  0x20, 0x02, 0x20, 0x07, 0x36, 0x02, 0x00, 0x20, 0x02, 0x20, 0x07, 0x36,
  0x02, 0x0c, 0x41, 0x00, 0x21, 0x03, 0x41, 0x8c, 0x10, 0x28, 0x02, 0x00,
  0x41, 0xc5, 0xbb, 0xf2, 0x88, 0x78, 0x6c, 0x21, 0x04, 0x02, 0x40, 0x41,
  0x94, 0x10, 0x28, 0x02, 0x00, 0x22, 0x00, 0x45, 0x0d, 0x00, 0x20, 0x00,
  0x41, 0x03, 0x71, 0x21, 0x05, 0x20, 0x00, 0x41, 0x04, 0x4f, 0x04, 0x40,
  0x20, 0x00, 0x41, 0x7c, 0x71, 0x21, 0x01, 0x03, 0x40, 0x20, 0x04, 0x20,
  0x02, 0x41, 0x0c, 0x6a, 0x20, 0x03, 0x6a, 0x22, 0x00, 0x2d, 0x00, 0x00,
  0x73, 0x41, 0x93, 0x83, 0x80, 0x08, 0x6c, 0x20, 0x00, 0x41, 0x01, 0x6a,
  0x2d, 0x00, 0x00, 0x73, 0x41, 0x93, 0x83, 0x80, 0x08, 0x6c, 0x20, 0x00,
  0x41, 0x02, 0x6a, 0x2d, 0x00, 0x00, 0x73, 0x41, 0x93, 0x83, 0x80, 0x08,
  0x6c, 0x20, 0x00, 0x41, 0x03, 0x6a, 0x2d, 0x00, 0x00, 0x73, 0x41, 0x93,
  0x83, 0x80, 0x08, 0x6c, 0x21, 0x04, 0x20, 0x01, 0x20, 0x03, 0x41, 0x04,
  0x6a, 0x22, 0x03, 0x47, 0x0d, 0x00, 0x0b, 0x0b, 0x20, 0x05, 0x45, 0x0d,
  0x00, 0x20, 0x02, 0x41, 0x0c, 0x6a, 0x20, 0x03, 0x6a, 0x21, 0x03, 0x03,
  0x40, 0x20, 0x04, 0x20, 0x03, 0x2d, 0x00, 0x00, 0x73, 0x41, 0x93, 0x83,
  0x80, 0x08, 0x6c, 0x21, 0x04, 0x20, 0x03, 0x41, 0x01, 0x6a, 0x21, 0x03,
  0x20, 0x05, 0x41, 0x01, 0x6b, 0x22, 0x05, 0x0d, 0x00, 0x0b, 0x0b, 0x41,
  0x88, 0x10, 0x20, 0x02, 0x41, 0x0c, 0x6a, 0x20, 0x02, 0x20, 0x04, 0x10,
  0x0d, 0x0b, 0x20, 0x02, 0x41, 0x10, 0x6a, 0x24, 0x00, 0x20, 0x07, 0x0c,
  0x01, 0x0b, 0x00, 0x0b, 0x0b, 0xba, 0x01, 0x01, 0x02, 0x7f, 0x41, 0xb0,
  0x10, 0x3f, 0x00, 0x41, 0x10, 0x74, 0x36, 0x02, 0x00, 0x41, 0x84, 0x10,
  0x41, 0xf0, 0x12, 0x36, 0x02, 0x00, 0x41, 0xb0, 0x10, 0x3f, 0x00, 0x41,
  0x10, 0x74, 0x36, 0x02, 0x00, 0x41, 0xe0, 0x12, 0x10, 0x09, 0x36, 0x02,
  0x00, 0x23, 0x00, 0x41, 0x10, 0x6b, 0x22, 0x00, 0x24, 0x00, 0x41, 0xe0,
  0x12, 0x28, 0x02, 0x00, 0x41, 0x01, 0x10, 0x00, 0x03, 0x40, 0x41, 0xe0,
  0x12, 0x28, 0x02, 0x00, 0x41, 0x01, 0x10, 0x01, 0x41, 0xe8, 0x07, 0x10,
  0x02, 0x41, 0xe0, 0x12, 0x28, 0x02, 0x00, 0x41, 0x00, 0x10, 0x01, 0x41,
  0xe8, 0x07, 0x10, 0x02, 0x20, 0x00, 0x41, 0x00, 0x36, 0x02, 0x08, 0x20,
  0x00, 0x41, 0x00, 0x36, 0x02, 0x0c, 0x20, 0x00, 0x41, 0x00, 0x36, 0x02,
  0x04, 0x20, 0x00, 0x41, 0x0c, 0x6a, 0x20, 0x00, 0x41, 0x08, 0x6a, 0x20,
  0x00, 0x41, 0x04, 0x6a, 0x10, 0x03, 0x20, 0x00, 0x2a, 0x02, 0x0c, 0x10,
  0x04, 0x20, 0x00, 0x2a, 0x02, 0x08, 0x10, 0x04, 0x20, 0x00, 0x2a, 0x02,
  0x04, 0x10, 0x04, 0x41, 0xe4, 0x12, 0x41, 0xe4, 0x12, 0x28, 0x02, 0x00,
  0x41, 0x01, 0x6a, 0x22, 0x01, 0x36, 0x02, 0x00, 0x20, 0x01, 0x10, 0x05,
  0x10, 0x06, 0x41, 0x01, 0x10, 0x07, 0x10, 0x08, 0x0c, 0x00, 0x0b, 0x00,
  0x0b, 0x0b, 0x34, 0x01, 0x00, 0x41, 0x80, 0x10, 0x0b, 0x2d, 0xc1, 0x82,
  0x01, 0x00, 0x70, 0x09, 0x00, 0x00, 0x48, 0x08, 0x00, 0x00, 0xc1, 0x82,
  0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x0c, 0x00,
  0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02
};
unsigned int app_wasm_len = 5239;


BLEService cycleTimeService("FFF0");
BLEIntCharacteristic tsCharacteristic("FFF1", BLERead | BLEBroadcast);

// Advertising parameters should have a global scope. Do NOT define them in 'setup' or in 'loop'
const uint8_t completeRawAdvertisingData[] = {0x01,0x01,0x06,0x09,0xff,0x01,0x01,0x00,0x01,0x02,0x03,0x04,0x05};

void advertise_packet(uint32_t ts) {
    Serial.print("ts: ");
    Serial.println(ts);

    // Build advertising data packet
    BLEAdvertisingData advData;
    // If a packet has a raw data parameter, then all the other parameters of the packet will be ignored
    advData.setRawData(completeRawAdvertisingData, sizeof(completeRawAdvertisingData));  
    // Copy set parameters in the actual advertising packet
    BLE.setAdvertisingData(advData);

    BLE.advertise();
}

m3ApiRawFunction(m3_adv_ble_ts) {
    m3ApiGetArg (uint32_t, ts);
    advertise_packet(ts);
    m3ApiSuccess();
}

m3ApiRawFunction(m3_adv_ble_stop) {
    BLE.stopAdvertise();
    m3ApiSuccess();
}

m3ApiRawFunction(m3_ble_pool) {
    BLE.poll();
    m3ApiSuccess();
}

m3ApiRawFunction(native_memcpy) {
    m3ApiGetArgMem  (uint8_t *, dst)
    m3ApiGetArgMem  (uint8_t *, src)
    m3ApiGetArgMem  (uint8_t *, dstend)

    do {
        *dst++ = *src++;
    } while (dst < dstend);

    m3ApiSuccess();
}

m3ApiRawFunction(m3_arduino_millis) {
  m3ApiReturnType (uint32_t)
  m3ApiReturn(millis());
}

m3ApiRawFunction(m3_arduino_delay) {
  m3ApiGetArg (uint32_t, ms)

  delay(ms);
  m3ApiSuccess();
}

// This maps pin modes from arduino_wasm_api.h
// to actual platform-specific values
uint8_t mapPinMode(uint8_t mode) {
  switch(mode) {
  case 0: return INPUT;
  case 1: return OUTPUT;
  case 2: return INPUT_PULLUP;
  }
  return INPUT;
}

m3ApiRawFunction(m3_arduino_pinMode) {
    m3ApiGetArg     (uint32_t, pin)
    m3ApiGetArg     (uint32_t, mode)
    pinMode(pin, (PinMode)mapPinMode(mode));
    m3ApiSuccess();
}

m3ApiRawFunction(m3_arduino_digitalWrite) {
    m3ApiGetArg     (uint32_t, pin)
    m3ApiGetArg     (uint32_t, value)
    digitalWrite(pin, value);
    m3ApiSuccess();
}

m3ApiRawFunction(m3_arduino_getPinLED) {
    m3ApiReturnType (uint32_t)
    m3ApiReturn(LED_BUILTIN);
}

m3ApiRawFunction(m3_arduino_print) {
    m3ApiGetArgMem  (const uint8_t *, buf)
    m3ApiGetArg     (uint32_t,        len)
    Serial.write(buf, len);
    m3ApiSuccess();
}

m3ApiRawFunction(m3_arduino_print_int) {
    m3ApiGetArg (uint32_t, i);
    Serial.println(i);
    m3ApiSuccess();
}

m3ApiRawFunction(m3_arduino_print_float) {
    m3ApiGetArg (float, i);
    Serial.println(i);
    m3ApiSuccess();
}

m3ApiRawFunction(m3_imu_gyro_read) {
    // m3ApiReturnType is void, but values can be written to the stack as needed.

    // Expecting that the Wasm module passes in the memory locations for x, y, and z.
    // These are pointers into the Wasm module's memory space, so we need to write the values there.

    m3ApiGetArgMem(float*, ret_x); // Get memory location for return value x
    m3ApiGetArgMem(float*, ret_y); // Get memory location for return value y
    m3ApiGetArgMem(float*, ret_z); // Get memory location for return value z

    float x = 0, y = 0, z = 0;
    
    // Check if the IMU gyroscope is available and read values
    if (IMU.gyroscopeAvailable()) {
        IMU.readGyroscope(x, y, z);
    }

    // Write the gyroscope readings into the Wasm memory locations
    *ret_x = x;
    *ret_y = y;
    *ret_z = z;

    // Return success
    m3ApiSuccess();
}


IM3Environment  env;
IM3Runtime      runtime;
IM3Module       module;
IM3Function     func_run;
uint8_t*        mem;

void load_wasm() {
     M3Result result = m3Err_none;
    
    if (!env) {
      env = m3_NewEnvironment ();
      if (!env) FATAL("NewEnvironment", "failed");
    }

    m3_FreeRuntime(runtime);

    runtime = m3_NewRuntime (env, WASM_STACK_SLOTS, NULL);
    if (!runtime) FATAL("NewRuntime", "failed");

    result = m3_ParseModule (env, &module, app_wasm, app_wasm_len);
    if (result) FATAL("ParseModule", result);

    result = m3_LoadModule (runtime, module);
    if (result) FATAL("LoadModule", result);

    const char* arduino = "arduino";

    m3_LinkRawFunction (module, arduino, "memcpy",           "v(iii)",   &native_memcpy);
    m3_LinkRawFunction (module, arduino, "millis",           "i()",    &m3_arduino_millis);
    m3_LinkRawFunction (module, arduino, "delay",            "v(i)",   &m3_arduino_delay);
    m3_LinkRawFunction (module, arduino, "pinMode",          "v(ii)",  &m3_arduino_pinMode);
    m3_LinkRawFunction (module, arduino, "digitalWrite",     "v(ii)",  &m3_arduino_digitalWrite);
    m3_LinkRawFunction (module, arduino, "getPinLED",        "i()",    &m3_arduino_getPinLED);
    m3_LinkRawFunction (module, arduino, "print",            "v(*i)",  &m3_arduino_print);
    m3_LinkRawFunction (module, arduino, "printInt",         "v(i)",  &m3_arduino_print_int);
    m3_LinkRawFunction (module, arduino, "printFloat",       "v(f)",  &m3_arduino_print_float);
    m3_LinkRawFunction (module, arduino, "imuGyroRead",      "v(***)", &m3_imu_gyro_read);
    // accell
    // gest

    // BLE binding
    m3_LinkRawFunction (module, arduino, "advBLETs", "v(i)", &m3_adv_ble_ts);
    m3_LinkRawFunction (module, arduino, "stopAdvBLE", "v()", &m3_adv_ble_stop);
    m3_LinkRawFunction (module, arduino, "blePool", "v()", &m3_ble_pool);

    mem = m3_GetMemory (runtime, NULL, 0);
    if (!mem) FATAL("GetMemory", "failed");

    result = m3_FindFunction (&func_run, runtime, "_start");
    if (result) FATAL("FindFunction", result);
}

void init_device() {
    //Init gyroscope, accelaration, magnetometer
    if (!IMU.begin()) {
        Serial.println("Failed to initialize IMU!");
        while(1);
    }

    if (!BLE.begin()) {
        Serial.println("failed to initialize BLE!");
        while (1);
    }

    cycleTimeService.addCharacteristic(tsCharacteristic);
    BLE.addService(cycleTimeService);

    BLEAdvertisingData scanData;
    scanData.setLocalName("NERVOUS-SYS-BLE");
    BLE.setScanResponseData(scanData);
}

void setup() {
    Serial.begin(115200);
    delay(100);

    // Wait for serial port to connect
    // Needed for native USB port only
    while(!Serial) {}

    uint32_t tend, tstart;
    TSTART();
      init_device();
    TFINISH("Device init");

    TSTART();
      load_wasm();
    TFINISH("Wasm3 init");

    Serial.println("Running WebAssembly...");

    wasm_task(NULL);
}

void wasm_task(void*) {
    M3Result result;

    while (true) {
        const uint64_t framestart = micros();

        result = m3_CallV (func_run);
        if (result) break;
    }

    if (result != m3Err_none) {
        M3ErrorInfo info;
        m3_GetErrorInfo (runtime, &info);
        Serial.print("Error: ");
        Serial.print(result);
        Serial.print(" (");
        Serial.print(info.message);
        Serial.println(")");
        if (info.file && strlen(info.file) && info.line) {
            Serial.print("At ");
            Serial.print(info.file);
            Serial.print(":");
            Serial.println(info.line);
        }
    }
}

void loop() { // should never reach
    delay(100);
}